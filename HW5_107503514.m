clear; 
close all;

W = 1; y = 0;
[x,z] = meshgrid(-2:0.2:2);
g =1./sqrt(128);

B1z = g.*-(x-0.5)./((x-0.5).^2+z.^2).*(((0.5-y)./sqrt((0.5-y).^2+(x-0.5).^2+z.^2))-((-0.5-y)./sqrt((-0.5-y).^2+(x-0.5).^2+z.^2)));
B1x = g.*z./((x-0.5).^2+z.^2).*(((0.5-y)./sqrt((0.5-y).^2+(x-0.5).^2+z.^2))-((-0.5-y)./sqrt((-0.5-y).^2+(x-0.5).^2+z.^2)));
B2z = g.*(y-0.5)./((y-0.5).^2+z.^2).*(((-0.5-x)./sqrt((-0.5-x).^2+(y-0.5).^2+z.^2))-((0.5-x)./sqrt((0.5-x).^2+(y-0.5).^2+z.^2)));
B4z = g.*(y+0.5)./((y+0.5).^2+z.^2).*(((0.5-x)./sqrt((0.5-x).^2+(y+0.5).^2+z.^2))-((-0.5-x)./sqrt((-0.5-x).^2+(y+0.5).^2+z.^2)));
B3z = g.*-(x+0.5)./((x+0.5).^2+z.^2).*(((-0.5-y)./sqrt((-0.5-y).^2+(x+0.5).^2+z.^2))-((0.5-y)./sqrt((0.5-y).^2+(x+0.5).^2+z.^2)));
B3x = g.*z./((x+0.5).^2+z.^2).*(((-0.5-y)./sqrt((-0.5-y).^2+(x+0.5).^2+z.^2))-((0.5-y)./sqrt((0.5-y).^2+(x+0.5).^2+z.^2)));

Bx = B1x+B3x;
Bz = B1z+B2z+B3z+B4z;

figure(1);
set(gca,'XTick',-2.5:0.5:2.5,'YTick',-2.5:0.5:2.5);
axis ([-2.5,2.5,-2.5,2.5]);
xlabel('x/W'); ylabel('z/W');
title('B Field Vector');
hold on;
plot(-0.5,0,'-or');
plot(0.5,0,'-xb');
quiver(x,z,Bx,Bz,'k','AutoScale','off');
hold off;
axis square

clear;

x = [-2:0.005:-0.501,-0.499:0.005:0.499,0.501:0.005:2];
y = [-2:0.005:-0.501,-0.499:0.005:0.499,0.501:0.005:2];
[X,Y] = meshgrid(x,y);
w = 1; z = 0;
h =1./sqrt(128);

B1z = h.*-(X-0.5)./((X-0.5).^2+z.^2).*(((0.5-Y)./sqrt((0.5-Y).^2+(X-0.5).^2+z.^2))-((-0.5-Y)./sqrt((-0.5-Y).^2+(X-0.5).^2+z.^2)));
B1x = h.*z./((X-0.5).^2+z.^2).*(((0.5-Y)./sqrt((0.5-Y).^2+(X-0.5).^2+z.^2))-((-0.5-Y)./sqrt((-0.5-Y).^2+(X-0.5).^2+z.^2)));
B2z = h.*(Y-0.5)./((Y-0.5).^2+z.^2).*(((-0.5-X)./sqrt((-0.5-X).^2+(Y-0.5).^2+z.^2))-((0.5-X)./sqrt((0.5-X).^2+(Y-0.5).^2+z.^2)));
B2y = h.*-z./((Y-0.5).^2+z.^2).*(((-0.5-X)./sqrt((-0.5-X).^2+(Y-0.5).^2+z.^2))-((0.5-X)./sqrt((0.5-X).^2+(Y-0.5).^2+z.^2)));
B3z = h.*-(X+0.5)./((X+0.5).^2+z.^2).*(((-0.5-Y)./sqrt((-0.5-Y).^2+(X+0.5).^2+z.^2))-((0.5-Y)./sqrt((0.5-Y).^2+(X+0.5).^2+z.^2)));
B3x = h.*z./((X+0.5).^2+z.^2).*(((-0.5-Y)./sqrt((-0.5-Y).^2+(X+0.5).^2+z.^2))-((0.5-Y)./sqrt((0.5-Y).^2+(X+0.5).^2+z.^2)));
B4z = h.*(Y+0.5)./((Y+0.5).^2+z.^2).*(((0.5-X)./sqrt((0.5-X).^2+(Y+0.5).^2+z.^2))-((-0.5-X)./sqrt((-0.5-X).^2+(Y+0.5).^2+z.^2)));
B4y = h.*-z./((Y+0.5).^2+z.^2).*(((0.5-X)./sqrt((0.5-X).^2+(Y+0.5).^2+z.^2))-((-0.5-X)./sqrt((-0.5-X).^2+(Y+0.5).^2+z.^2)));

Bx = B1x+B3x;
By = B2y+B4y;
Bz = B1z+B2z+B3z+B4z;
B = sqrt(Bx.^2+By.^2+Bz.^2);

figure(2);
contour(X,Y,log2(B),(-7:0.055:5));
hold on;
colormap jet
colorbar ('Ticks',(-7:1:5))

set(gca,'XTick',-2.5:0.5:2.5,'YTick',-2.5:0.5:2.5);
axis ([-2.5,2.5,-2.5,2.5]);
xlabel('x/W'); ylabel('y/W');
title('log_2|B|');
hold off;
axis square